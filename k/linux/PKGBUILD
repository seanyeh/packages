pkgname=linux
pkgver=3.16.3
pkgrel=1
pkgdesc="The Linux kernel."
arch=("x86_64")
url="http://www.kernel.org"
license=("GPLv2")
#makedepends=(gcc lz4)

source=("https://www.kernel.org/pub/linux/kernel/v3.x/linux-${pkgver}.tar.xz"
		https://grsecurity.net/test/grsecurity-3.0-3.16.3-201409282025.patch
		config.xz)
sha256sums=(5391a34f935f35928408d058efcf18244cd9967f0ac19e2197d788ec348655d9
			42ccb9171b698eb89a74be777710ecb0aaaad3173ab77461380acf3e42797f93
			ff1cb95142166d8b72e0c3086a6a8c3098d895a98ccfc24377b795e40da5e86b)

build() {
	cd "${srcdir}/${pkgname}-${pkgver}"
	xzcat "${srcdir}/config.xz" > .config
	make -j2
}

package() {
	cd "${srcdir}/${pkgname}-${pkgver}"
	
	mkdir -p "${pkgdir}/boot"
	
	install -m 644 arch/x86/boot/bzImage "${pkgdir}"/boot/vmlinuz-${pkgver}
	make modules_install INSTALL_MOD_PATH="${pkgdir}"
	make headers_install INSTALL_HDR_PATH="${pkgdir}/usr"
}
